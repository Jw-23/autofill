<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Autofill Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <button class="menu-toggle" id="menu-toggle">‚ò∞</button>
  
  <div class="app-container">
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <span style="font-size: 24px;">ü§ñ</span>
        <h1 style="margin:0; font-size: 20px;">AI Autofill</h1>
      </div>
      
      <div class="nav-item active" data-section="vault">
        <span>üì¶</span> <span data-i18n="vaultMenu">Vault</span>
      </div>
      <div class="nav-item" data-section="whitelist">
        <span>üõ°Ô∏è</span> <span data-i18n="whitelistMenu">Whitelist</span>
      </div>
      <div class="nav-item" data-section="data-mgmt">
        <span>üíæ</span> <span data-i18n="dataMgmtMenu">Data Management</span>
      </div>
      <div class="nav-item" data-section="settings">
        <span>‚öôÔ∏è</span> <span data-i18n="settingsMenu">Settings</span>
      </div>

      <div style="margin-top: auto; padding: 20px; border-top: 1px solid #f1f3f4;">
        <button id="lang-toggle" class="lang-btn" style="width: 100%; border: 1px solid #dadce0;">English / ‰∏≠Êñá</button>
      </div>
    </nav>

    <main class="main-content">
      <!-- Vault Section -->
      <section id="vault" class="content-section active">
        <div id="unlock-card" class="card" style="display:none; text-align:center;">
          <h3 data-i18n="unlockTitle">Unlock Vault</h3>
          <p data-i18n="unlockDesc">Enter master password to access your data.</p>
          <input type="password" id="unlock-pass" placeholder="Password" style="margin-bottom:15px;">
          <button id="unlock-btn" class="save-btn" data-i18n="unlockBtn">Unlock</button>
        </div>

        <div id="add-form" class="card">
          <h3 data-i18n="addNewInfo">Add New Info</h3>
          <div class="form-group">
            <label data-i18n="labelKeyname">Keyname</label>
            <input type="text" id="new-keyname" placeholder="unique_key">
          </div>
          <div class="form-group">
            <label data-i18n="labelDesc">Description</label>
            <input type="text" id="new-description" placeholder="e.g. My mobile phone for deliveries">
          </div>
          <div class="form-group">
            <label data-i18n="labelValue">Value</label>
            <input type="text" id="new-value" placeholder="The actual content to fill">
          </div>
          <div id="new-fake-value-group" class="form-group" style="display:none;">
            <label data-i18n="labelFakeValue">Fake Value</label>
            <input type="text" id="new-fake-value" placeholder="e.g. 138-0000-0000">
          </div>
          <div class="form-group" style="display:flex; align-items:center; gap:8px;">
            <input type="checkbox" id="new-is-secret" style="width:auto;">
            <label for="new-is-secret" style="margin:0;" data-i18n="labelSecret">High Sensitivity</label>
          </div>
          <div style="display: flex; gap: 10px;">
            <button id="add-btn" class="save-btn" data-i18n="saveBtn">Add Entry</button>
            <button id="smart-add-btn" class="save-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border:none;" data-i18n="smartAddBtn">‚ú® Smart Add</button>
          </div>
        </div>

        <h2 data-i18n="savedInfo">Saved Information</h2>
        <div id="info-list" class="card" style="padding:0;"></div>
      </section>

      <!-- Whitelist Section -->
      <section id="whitelist" class="content-section">
        <h2 data-i18n="whitelistTitle">Trusted Websites</h2>
        <div class="card">
          <p style="font-size:13px; color:#666;" data-i18n="whitelistDesc">Real values for high-sensitivity data are only filled on these sites.</p>
          <div style="display:flex; gap:10px; margin-bottom:15px;">
            <input type="text" id="new-whitelist-item" placeholder="e.g. github.com" style="flex:1;">
            <button id="add-whitelist-btn" class="save-btn" data-i18n="addBtn">Add</button>
          </div>
          <div id="whitelist-list" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
        </div>
      </section>

      <!-- Data Management Section -->
      <section id="data-mgmt" class="content-section">
        <h2 data-i18n="dataManagement">Data Management</h2>
        <div class="card">
          <p style="font-size:13px; color:#666;" data-i18n="dataMgmtDesc">Backup or restore your personal information. Encrypted data remains encrypted.</p>
          <div style="display:flex; gap:10px; margin-bottom: 20px;">
            <button id="export-btn" class="save-btn" data-i18n="exportBtn">Export (ÂØºÂá∫)</button>
            <button id="import-btn" class="save-btn" style="background-color:#1aa260;" data-i18n="importBtn">Import (ÂØºÂÖ•)</button>
            <input type="file" id="import-file" style="display:none;" accept=".json">
          </div>

          <div style="border-top: 1px solid #eee; padding-top: 15px;">
            <div id="format-help-toggle" style="cursor:pointer; color:var(--primary-color); font-size:13px; display:flex; align-items:center; gap:5px;">
              <span id="format-help-icon">‚ñ∂</span> <span data-i18n="formatHelpTitle">Import Format Instructions</span>
            </div>
            <div id="format-help-content" style="display:none; margin-top:10px; font-size:12px; color:#555; background:#f9f9f9; padding:12px; border-radius:4px; line-height:1.6;">
              <p><strong data-i18n="formatPlainTitle">Unencrypted JSON Format:</strong></p>
              <pre style="background:#eee; padding:8px; border-radius:4px; overflow-x:auto;">{
  "type": "ai-autofill-export",
  "version": 1,
  "encrypted": false,
  "data": [
    {
      "keyname": "example_key",
      "description": "Optional description",
      "value": "Actual value",
      "isSecret": false,
      "fakeValue": ""
    }
  ]
}</pre>
              <p data-i18n="formatDesc">You can manually create or edit unencrypted files for bulk import. If encryption is enabled, imported plain data will be automatically encrypted.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" class="content-section">
        <h2 data-i18n="settingsTitle">General Settings</h2>
        <div class="card" style="padding: 0;">
          <div class="setting-row">
            <div>
              <div style="font-weight: 500;" data-i18n="oneByOne">One-by-one mode</div>
              <div style="font-size: 12px; color: #666;" data-i18n="oneByOneDesc">Show suggestion one by one</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="one-by-one-toggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div>
              <div style="font-weight: 500;" data-i18n="clusterMode">Smart Cluster Mode</div>
              <div style="font-size: 12px; color: #666;" data-i18n="clusterModeDesc">Group related inputs by structure</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="cluster-toggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div>
              <div style="font-weight: 500;" data-i18n="debugLogs">Debug logs</div>
              <div style="font-size: 12px; color: #666;" data-i18n="debugLogsDesc">Show detailed logs in console</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="debug-toggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="setting-row">
            <div>
              <div style="font-weight: 500;" data-i18n="floatingPrompt">Floating Prompt</div>
              <div style="font-size: 12px; color: #666;" data-i18n="floatingPromptDesc">Show AI prompt box on input focus</div>
            </div>
            <label class="switch">
              <input type="checkbox" id="floating-prompt-toggle">
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <h2 data-i18n="securityTitle" style="margin-top: 30px;">Security</h2>
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div id="security-status-display" style="font-weight: 500;"></div>
            <button id="security-btn" class="lang-btn" style="color:var(--primary-color);">Manage Security</button>
          </div>
          <p style="font-size:13px; color:#666;" data-i18n="securityDesc">Encryption protects your data with a master password.</p>
        </div>

        <h2 style="margin-top: 30px;" data-i18n="AISettingTitle">AI Settings</h2>
        <div class="card">
          <div class="setting-row">
            <div style="font-weight: 500;" data-i18n="aiProvider">Provider</div>
            <div style="display:flex; gap:15px; flex-wrap:wrap;">
              <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                <input type="radio" name="ai-provider" value="local" checked> <span data-i18n="aiProviderLocal">Local (Gemini Nano)</span>
              </label>
              <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                <input type="radio" name="ai-provider" value="remote"> <span data-i18n="aiProviderRemote">Remote (OpenAI API)</span>
              </label>
            </div>
          </div>

          <!-- Local Options -->
          <div id="ai-local-options" style="margin-top:15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; background:#f9f9f9; padding:10px; border-radius:4px;">
              <div data-i18n="aiLoadingDesc">Gemini Nano model status</div>
              <button id="check-ai-btn" class="lang-btn" data-i18n="checkAI">Check Status</button>
            </div>
          </div>

          <!-- Remote Options -->
          <div id="ai-remote-options" style="display:none; margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
            <p style="font-size:12px; color:#e07a5f; margin-bottom:15px; line-height:1.5;" data-i18n="aiRemoteDesc">Privacy Note...</p>
            <div class="form-group">
              <label data-i18n="aiBaseUrl">API Base URL</label>
              <input type="text" id="api-url" placeholder="https://api.openai.com/v1" value="https://api.openai.com/v1">
            </div>
            <div class="form-group">
              <label data-i18n="aiKey">API Key</label>
              <input type="password" id="api-key" placeholder="sk-...">
            </div>
            <div style="display:flex; gap:10px; align-items:flex-end;">
              <div class="form-group" style="flex:1; margin-bottom:0;">
                <label data-i18n="aiModel">Model</label>
                <select id="api-model" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; height:36px;">
                  <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                  <option value="gpt-4">gpt-4</option>
                  <option value="gpt-4o">gpt-4o</option>
                  <option value="gpt-4o-mini">gpt-4o-mini</option>
                </select>
              </div>
              <button id="fetch-models-btn" class="lang-btn" style="height:36px;" data-i18n="aiFetchModels">Fetch Models</button>
            </div>
            <div id="fetch-status" style="margin-top:8px; font-size:12px; height:15px;"></div>
          </div>
          
          <div style="display:flex; justify-content:flex-end; margin-top:20px;">
            <button id="save-ai-settings" class="save-btn" data-i18n="saveAiSettings">Save AI Settings</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Edit Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content" style="padding-top: 0;">
      <div class="modal-drag-handle">
         <span class="close" onclick="document.getElementById('edit-modal').style.display='none'">&times;</span>
      </div>
      <h3 data-i18n="editTitle" style="margin-top: 10px;">Edit Info</h3>
      <input type="hidden" id="edit-old-key">
      <div class="form-group">
        <label data-i18n="labelKeyname">Keyname</label>
        <input type="text" id="edit-keyname">
      </div>
      <div class="form-group">
        <label data-i18n="labelDesc">Description</label>
        <input type="text" id="edit-description">
      </div>
      <div class="form-group">
        <label data-i18n="labelValue">Value</label>
        <input type="text" id="edit-value">
      </div>
      <div id="edit-fake-value-group" class="form-group" style="display:none;">
        <label data-i18n="labelFakeValue">Fake Value</label>
        <input type="text" id="edit-fake-value">
      </div>
      <div class="form-group" style="display:flex; align-items:center; gap:8px;">
        <input type="checkbox" id="edit-is-secret" style="width:auto;">
        <label for="edit-is-secret" style="margin:0;" data-i18n="labelSecret">High Sensitivity</label>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
        <button id="cancel-edit" class="lang-btn" data-i18n="cancelBtn">Cancel</button>
        <button id="save-edit" class="save-btn" data-i18n="updateBtn">Update</button>
      </div>
    </div>
  </div>

  <!-- Security Modal -->
  <div id="security-modal" class="modal">
    <div class="modal-content">
      <h3 data-i18n="securityTitle">Security Settings</h3>
      <p id="security-status"></p>
      <div id="set-pass-area">
        <div class="form-group">
          <label data-i18n="newMasterPass">New Master Password</label>
          <input type="password" id="new-master-pass">
        </div>
        <div class="form-group">
          <label data-i18n="confirmMasterPass">Confirm Password</label>
          <input type="password" id="confirm-master-pass">
        </div>
        <button id="enable-encryption" class="save-btn" data-i18n="enableEncryption">Enable Encryption</button>
      </div>
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
        <button id="factory-reset" class="delete-btn" style="width: 100%; border: 1px solid var(--danger-color);" data-i18n="resetData">Destroy All Data & Reset</button>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
        <button id="close-security" class="lang-btn" data-i18n="closeBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Prompt Modal -->
  <div id="prompt-modal" class="modal">
    <div class="modal-content">
      <h3 id="prompt-title">Prompt</h3>
      <p id="prompt-desc"></p>
      <div class="form-group">
        <input type="password" id="prompt-input" style="margin-top: 10px;">
      </div>
      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
        <button id="prompt-cancel" class="lang-btn" data-i18n="cancelBtn">Cancel</button>
        <button id="prompt-ok" class="save-btn" data-i18n="unlockBtn">OK</button>
      </div>
    </div>
  </div>

  <!-- AI Model Loading Modal -->
  <div id="ai-loading-modal" class="modal">
    <div class="modal-content" style="text-align:center;">
      <h3 data-i18n="aiLoadingTitle">Initializing AI Model</h3>
      <p data-i18n="aiLoadingDesc">The AI model (Gemini Nano) is being prepared for the first time. This may take a while depending on your internet speed.</p>
      <div style="width:100%; height:8px; background:#eee; border-radius:4px; margin:20px 0; overflow:hidden;">
        <div id="ai-progress-bar" style="width:0%; height:100%; background:var(--primary-color); transition: width 0.3s;"></div>
      </div>
      <p id="ai-progress-text">0%</p>
    </div>
  </div>

  <!-- Smart Add Modal -->
  <div id="smart-add-modal" class="modal">
    <div class="modal-content" style="max-width: 600px; padding-top: 0;">
      <div class="modal-drag-handle">
        <span class="close" id="smart-add-close">&times;</span>
      </div>
      <h2 data-i18n="smartAddModalTitle" style="margin-top: 10px;">AI Smart Add</h2>
      <p data-i18n="smartAddDesc" style="color: #666; margin-bottom: 10px;"></p>
      
      <textarea id="smart-add-input" rows="5" style="width:100%; padding:10px; font-family:inherit; border:1px solid #ccc; border-radius:4px; resize:vertical;" placeholder=""></textarea>
      
      <div id="smart-add-preview-area" style="display:none; margin-top: 15px;">
         <h4 data-i18n="smartAddPreviewTitle" style="margin-bottom:10px;">Preview</h4>
         <div id="smart-add-list" style="max-height: 250px; overflow-y: auto; border: 1px solid #eee; padding: 10px; background: #fafafa; border-radius: 4px;">
           <!-- Generated items will go here -->
         </div>
         <div style="text-align: right; margin-top: 10px;">
             <button id="smart-add-apply-btn" class="save-btn" data-i18n="smartAddConfirm">Add Selection</button>
         </div>
      </div>

      <div style="text-align: right; margin-top: 15px;" id="smart-add-actions">
        <button id="smart-add-clear-btn" class="lang-btn" style="margin-right: 10px;">Clear</button>
        <button id="smart-add-submit-btn" class="save-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-i18n="smartAddGenerate">Generate</button>
      </div>
    </div>
  </div>

  <script type="module" src="options.js"></script>
</body>
</html>
